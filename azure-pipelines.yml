name: Test-Git-Pipeline

pool:
  name: Dev Agents

steps:
  # 1️⃣ Checkout repo with full history and credentials
  - checkout: self
    clean: true
    persistCredentials: true
    fetchDepth: 0

  # 2️⃣ Print environment variables (secrets will be masked)
  - script: |
      echo PUBLISH_TOKEN = %PUBLISH_TOKEN%
      echo GIT_AUTH_TOKEN = %GIT_AUTH_TOKEN%
    displayName: "Check Environment Variables"
    env:
      PUBLISH_TOKEN: $(PUBLISH_TOKEN)
      GIT_AUTH_TOKEN: $(GIT_AUTH_TOKEN)

  # 3️⃣ Ensure local develop branch exists
  - script: |
      git fetch origin develop
      git checkout -B develop origin/develop
      git status
      git log -3 --oneline
    displayName: "Prepare Local Branch"

  # 4️⃣ Test git push dry-run using PAT (safe, no actual push)
  - script: |
      git remote set-url origin https://$(GIT_AUTH_TOKEN)@tfs.1st.co.com/tfs/AbrPlus/AbrPlus-UI-Kit/_git/AbrPlus-UI-Kit
      git push --dry-run origin develop
    displayName: "Test Git Push Dry Run"
    env:
      GIT_AUTH_TOKEN: $(GIT_AUTH_TOKEN)
